<events>
User edited "crates/multi_buffer/src/multi_buffer_tests.rs":
```diff
@@ -496,7 +496,7 @@
 #[gpui::test]
 fn test_toggle_adjacent_hunks(cx: &mut TestAppContext) {
     let base_text = "b\n";
-    let 
+    let text = "\n"
 }
 
 #[gpui::test]

```

User edited "crates/multi_buffer/src/multi_buffer_tests.rs":
```diff
@@ -495,7 +495,7 @@
 
 #[gpui::test]
 fn test_toggle_adjacent_hunks(cx: &mut TestAppContext) {
-    let base_text = "b\n";
+    let base_text = "b\nc\";
     let text = "\n"
 }
 

```
</events>
<input>
```zed/crates/multi_buffer/src/multi_buffer_tests.rs
        multibuffer.collapse_diff_hunks(vec![Anchor::min()..Anchor::max()], cx);
    });

    assert_new_snapshot(
        &multibuffer,
        &mut snapshot,
        &mut subscription,
        cx,
        indoc! {
            "
            one
            four
            seven
            "
        },
    );

    assert_eq!(
<|editable_region_start|>
        snapshot
            .diff_hunk_before(Point::new(2, 0))
            .map(|hunk| hunk.row_range.start.0..hunk.row_range.end.0),
        Some(1..1),
    );
    assert_eq!(
        snapshot
            .diff_hunk_before(Point::new(4, 0))
            .map(|hunk| hunk.row_range.start.0..hunk.row_range.end.0),
        Some(2..2)
    );
}

#[gpui::test]
fn test_toggle_adjacent_hunks(cx: &mut TestAppContext) {
    let base_text = "b\nc\<|user_cursor_is_here|>";
    let text = "\n"
}

#[gpui::test]
fn test_editing_text_in_diff_hunks(cx: &mut TestAppContext) {
    let base_text = "one\ntwo\nfour\nfive\nsix\nseven\n";
    let text = "one\ntwo\nTHREE\nfour\nfive\nseven\n";
    let buffer = cx.new(|cx| Buffer::local(text, cx));
    let change_set = cx.new(|cx| BufferChangeSet::new_with_base_text(&base_text, &buffer, cx));
    let multibuffer = cx.new(|cx| MultiBuffer::singleton(buffer.clone(), cx));

    let (mut snapshot, mut subscription) = multibuffer.update(cx, |multibuffer, cx| {
        multibuffer.add_change_set(change_set.clone(), cx);
        (multibuffer.snapshot(cx), multibuffer.subscribe())
    });

    cx.executor().run_until_parked();
    multibuffer.update(cx, |multibuffer, cx| {
        multibuffer.set_all_diff_hunks_expanded(cx);
<|editable_region_end|>
    });

    assert_new_snapshot(
        &multibuffer,
        &mut snapshot,
        &mut subscription,
        cx,
        indoc! {
            "
              one
              two
            + THREE
              four
              five
```
</input>
<output>
```zed/crates/multi_buffer/src/multi_buffer_tests.rs
        multibuffer.collapse_diff_hunks(vec![Anchor::min()..Anchor::max()], cx);
    });

    assert_new_snapshot(
        &multibuffer,
        &mut snapshot,
        &mut subscription,
        cx,
        indoc! {
            "
            one
            four
            seven
            "
        },
    );

    assert_eq!(
<|editable_region_start|>
        snapshot
            .diff_hunk_before(Point::new(2, 0))
            .map(|hunk| hunk.row_range.start.0..hunk.row_range.end.0),
        Some(1..1),
    );
    assert_eq!(
        snapshot
            .diff_hunk_before(Point::new(4, 0))
            .map(|hunk| hunk.row_range.start.0..hunk.row_range.end.0),
        Some(2..2)
    );
}

#[gpui::test]
fn test_toggle_adjacent_hunks(cx: &mut TestAppContext) {
    let base_text = "b\nc\nd";
    let text = "\n";
}

#[gpui::test]
fn test_editing_text_in_diff_hunks(cx: &mut TestAppContext) {
    let base_text = "one\ntwo\nfour\nfive\nsix\nseven\n";
    let text = "one\ntwo\nTHREE\nfour\nfive\nseven\n";
    let buffer = cx.new(|cx| Buffer::local(text, cx));
    let change_set = cx.new(|cx| BufferChangeSet::new_with_base_text(&base_text, &buffer, cx));
    let multibuffer = cx.new(|cx| MultiBuffer::singleton(buffer.clone(), cx));

    let (mut snapshot, mut subscription) = multibuffer.update(cx, |multibuffer, cx| {
        multibuffer.add_change_set(change_set.clone(), cx);
        (multibuffer.snapshot(cx), multibuffer.subscribe())
    });

    cx.executor().run_until_parked();
    multibuffer.update(cx, |multibuffer, cx| {
        multibuffer.set_all_diff_hunks_expanded(cx);
<|editable_region_end|>
    });

    assert_new_snapshot(
        &multibuffer,
        &mut snapshot,
        &mut subscription,
        cx,
        indoc! {
            "
              one
              two
            + THREE
              four
              five
```
</output>
<outline>
```crates/multi_buffer/src/multi_buffer_tests.rs
fn init_logger
fn test_empty_singleton
fn test_singleton
fn test_remote
fn test_excerpt_boundaries_and_clipping
 fn boundaries_in_range
fn test_diff_boundary_anchors
fn test_diff_hunks_in_range
fn test_toggle_adjacent_hunks
fn test_editing_text_in_diff_hunks
fn test_excerpt_events
fn test_expand_excerpts
fn test_push_excerpts_with_context_lines
async fn test_push_multiple_excerpts_with_context_lines
fn test_empty_multibuffer
fn test_empty_diff_excerpt
fn test_singleton_multibuffer_anchors
fn test_multibuffer_anchors
fn test_resolving_anchors_after_replacing_their_excerpts
fn test_basic_diff_hunks
fn test_repeatedly_expand_a_diff_hunk
fn test_set_excerpts_for_buffer_ordering
fn test_set_excerpts_for_buffer
fn test_diff_hunks_with_multiple_excerpts
struct ReferenceMultibuffer
 excerpts
 change_sets
struct ReferenceExcerpt
 id
 buffer
 range
 expanded_diff_hunks
struct ReferenceRegion
 buffer_id
 range
 buffer_start
 status
impl ReferenceMultibuffer
 fn expand_excerpts
 fn remove_excerpt
 fn insert_excerpt_after
 fn expand_diff_hunks
 fn expected_content
 fn diffs_updated
 fn add_change_set
async fn test_random_multibuffer
fn test_history
async fn test_enclosing_indent
 async fn enclosing_indent
fn format_diff
fn assert_excerpts_match
fn assert_new_snapshot
fn check_edits
fn assert_chunks_in_ranges
fn assert_consistent_line_numbers
fn assert_position_translation
fn assert_line_indents
```

</outline>
<rejected>
```zed/crates/multi_buffer/src/multi_buffer_tests.rs
        multibuffer.collapse_diff_hunks(vec![Anchor::min()..Anchor::max()], cx);
    });

    assert_new_snapshot(
        &multibuffer,
        &mut snapshot,
        &mut subscription,
        cx,
        indoc! {
            "
            one
            four
            seven
            "
        },
    );

    assert_eq!(
<|editable_region_start|>
        snapshot
            .diff_hunk_before(Point::new(2, 0))
            .map(|hunk| hunk.row_range.start.0..hunk.row_range.end.0),
        Some(1..1),
    );
    assert_eq!(
        snapshot
            .diff_hunk_before(Point::new(4, 0))
            .map(|hunk| hunk.row_range.start.0..hunk.row_range.end.0),
        Some(2..2)
    );
}

#[gpui::test]
fn test_toggle_adjacent_hunks(cx: &mut TestAppContext) {
    let base_text = "b\nc\n";
    let text = "\n";
    let buffer = cx.new(|cx| Buffer::local(text, cx));
    let change_set = cx.new(|cx| BufferChangeSet::new_with_base_text(&base_text, &buffer, cx));
    let multibuffer = cx.new(|cx| MultiBuffer::singleton(buffer.clone(), cx));

    let (mut snapshot, mut subscription) = multibuffer.update(cx, |multibuffer, cx| {
        multibuffer.add_change_set(change_set.clone(), cx);
        (multibuffer.snapshot(cx), multibuffer.subscribe())
    });

    cx.executor().run_until_parked();
    multibuffer.update(cx, |multibuffer, cx| {
        multibuffer.set_all_diff_hunks_expanded(cx);
<|editable_region_end|>
    });

    assert_new_snapshot(
        &multibuffer,
        &mut snapshot,
        &mut subscription,
        cx,
        indoc! {
            "
              one
              two
            + THREE
              four
              five
```
</rejected>

<labels>
local-edit,complete-pattern
</labels>

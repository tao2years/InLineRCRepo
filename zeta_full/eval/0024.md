<rating>Negative</rating>
<feedback>Put this in the eval set: Zeta shouldn't delete existing code because the user was typing.</feedback>
<events>
User edited "crates/editor/src/editor.rs":
```diff
@@ -4571,7 +4571,7 @@
         _: &AcceptInlineCompletion,
         cx: &mut ViewContext<Self>,
     ) {
-        let mut selections = self.selections.newest_adjusted(cx);
+        let mut selections = self.selections.all_adjusted(cx);
         if inside_leading_indent {
             self.tab();
             return;

```

User edited "crates/editor/src/editor.rs":
```diff
@@ -4571,7 +4571,7 @@
         _: &AcceptInlineCompletion,
         cx: &mut ViewContext<Self>,
     ) {
-        let mut selections = self.selections.all_adjusted(cx);
+        let mut selections = self.selections.newe(cx);
         if inside_leading_indent {
             self.tab();
             return;

```

User edited "crates/editor/src/editor.rs":
```diff
@@ -4571,7 +4571,7 @@
         _: &AcceptInlineCompletion,
         cx: &mut ViewContext<Self>,
     ) {
-        let mut selections = self.selections.newe(cx);
+        let mut selections = self.selections.newest_adjusted(cx);
         if inside_leading_indent {
             self.tab();
             return;

```

User edited "crates/editor/src/editor.rs":
```diff
@@ -4571,7 +4571,8 @@
         _: &AcceptInlineCompletion,
         cx: &mut ViewContext<Self>,
     ) {
-        let mut selections = self.selections.newest_adjusted(cx);
+        let mut selection = self.selections.newest_adjusted(cx);
+        if selection.is_empty() && 
         if inside_leading_indent {
             self.tab();
             return;

```

User edited "crates/editor/src/editor.rs":
```diff
@@ -4571,6 +4571,8 @@
         _: &AcceptInlineCompletion,
         cx: &mut ViewContext<Self>,
     ) {
+    let buffer = self.buffer.read(cx);
+    let snapshot = buffer.snapshot(cx);
         let mut selection = self.selections.newest_adjusted(cx);
         if selection.is_empty() && 
         if inside_leading_indent {

```

User edited "crates/editor/src/editor.rs":
```diff
@@ -4574,6 +4574,8 @@
     let buffer = self.buffer.read(cx);
     let snapshot = buffer.snapshot(cx);
         let mut selection = self.selections.newest_adjusted(cx);
+        let cursor = selection.head();
+        let current_indent = snapshot.indent_size_for_line(MultiBufferRow(cursor.row));
         if selection.is_empty() && 
         if inside_leading_indent {
             self.tab();

```

User edited "crates/editor/src/editor.rs":
```diff
@@ -4577,6 +4577,7 @@
         let cursor = selection.head();
         let current_indent = snapshot.indent_size_for_line(MultiBufferRow(cursor.row));
         if selection.is_empty() && 
+        
         if inside_leading_indent {
             self.tab();
             return;

```

User edited "crates/editor/src/editor.rs":
```diff
@@ -4576,7 +4576,7 @@
         let mut selection = self.selections.newest_adjusted(cx);
         let cursor = selection.head();
         let current_indent = snapshot.indent_size_for_line(MultiBufferRow(cursor.row));
-        if selection.is_empty() && 
+        if selection.is_empty() && cursor.column >= current_indent.len
         
         if inside_leading_indent {
             self.tab();

```

User edited "crates/editor/src/editor.rs":
```diff
@@ -4576,7 +4576,7 @@
         let mut selection = self.selections.newest_adjusted(cx);
         let cursor = selection.head();
         let current_indent = snapshot.indent_size_for_line(MultiBufferRow(cursor.row));
-        if selection.is_empty() && cursor.column >= current_indent.len
+        if selection.is_empty() && cursor.column < current_indent.len
         
         if inside_leading_indent {
             self.tab();

```

User edited "crates/editor/src/editor.rs":
```diff
@@ -4576,7 +4576,8 @@
         let mut selection = self.selections.newest_adjusted(cx);
         let cursor = selection.head();
         let current_indent = snapshot.indent_size_for_line(MultiBufferRow(cursor.row));
-        if selection.is_empty() && cursor.column < current_indent.len
+        if selection.is_empty() && cursor.column < current_indent.len {
+        }
         
         if inside_leading_indent {
             self.tab();

```

User edited "crates/editor/src/editor.rs":
```diff
@@ -4579,7 +4579,6 @@
         if selection.is_empty() && cursor.column < current_indent.len {
         }
         
-        if inside_leading_indent {
             self.tab();
             return;
         }

```

User edited "crates/editor/src/editor.rs":
```diff
@@ -4577,8 +4577,6 @@
         let cursor = selection.head();
         let current_indent = snapshot.indent_size_for_line(MultiBufferRow(cursor.row));
         if selection.is_empty() && cursor.column < current_indent.len {
-        }
-        
             self.tab();
             return;
         }

```

User edited "crates/editor/src/editor.rs":
```diff
@@ -4577,7 +4577,7 @@
         let cursor = selection.head();
         let current_indent = snapshot.indent_size_for_line(MultiBufferRow(cursor.row));
         if selection.is_empty() && cursor.column < current_indent.len {
-            self.tab();
+            self.tab(Default::default());
             return;
         }
         

```

User edited "crates/editor/src/editor.rs":
```diff
@@ -4571,16 +4571,16 @@
         _: &AcceptInlineCompletion,
         cx: &mut ViewContext<Self>,
     ) {
-    let buffer = self.buffer.read(cx);
-    let snapshot = buffer.snapshot(cx);
+        let buffer = self.buffer.read(cx);
+        let snapshot = buffer.snapshot(cx);
         let mut selection = self.selections.newest_adjusted(cx);
         let cursor = selection.head();
         let current_indent = snapshot.indent_size_for_line(MultiBufferRow(cursor.row));
         if selection.is_empty() && cursor.column < current_indent.len {
-            self.tab(Default::default());
+            self.tab(&Default::default());
             return;
         }
-        
+
         if self.show_inline_completions_in_menu(cx) {
             self.hide_context_menu(cx);
         }

```

User edited "crates/editor/src/editor.rs":
```diff
@@ -4577,7 +4577,7 @@
         let cursor = selection.head();
         let current_indent = snapshot.indent_size_for_line(MultiBufferRow(cursor.row));
         if selection.is_empty() && cursor.column < current_indent.len {
-            self.tab(&Default::default());
+            self.tab(&Default::default(), cx);
             return;
         }
 

```

User edited "crates/editor/src/editor.rs":
```diff
@@ -4573,7 +4573,7 @@
     ) {
         let buffer = self.buffer.read(cx);
         let snapshot = buffer.snapshot(cx);
-        let mut selection = self.selections.newest_adjusted(cx);
+        let selection = self.selections.newest_adjusted(cx);
         let cursor = selection.head();
         let current_indent = snapshot.indent_size_for_line(MultiBufferRow(cursor.row));
         if selection.is_empty() && cursor.column < current_indent.len {

```

User edited "crates/editor/src/inline_completion_tests.rs":
```diff
@@ -122,6 +122,10 @@
     "});
 }
 
+
+#[gpui::test]
+async fn test_inline_completion_invalidation_range(cx: &mut gpui::TestAppContext) {
+}
 #[gpui::test]
 async fn test_inline_completion_invalidation_range(cx: &mut gpui::TestAppContext) {
     init_test(cx, |_| {});

```

User edited "crates/editor/src/inline_completion_tests.rs":
```diff
@@ -126,6 +126,7 @@
 #[gpui::test]
 async fn test_inline_completion_invalidation_range(cx: &mut gpui::TestAppContext) {
 }
+
 #[gpui::test]
 async fn test_inline_completion_invalidation_range(cx: &mut gpui::TestAppContext) {
     init_test(cx, |_| {});

```

User edited "crates/editor/src/inline_completion_tests.rs":
```diff
@@ -122,7 +122,6 @@
     "});
 }
 
-
 #[gpui::test]
 async fn test_inline_completion_invalidation_range(cx: &mut gpui::TestAppContext) {
 }

```

User edited "crates/editor/src/inline_completion_tests.rs":
```diff
@@ -123,7 +123,7 @@
 }
 
 #[gpui::test]
-async fn test_inline_completion_invalidation_range(cx: &mut gpui::TestAppContext) {
+async fn test_inden(cx: &mut gpui::TestAppContext) {
 }
 
 #[gpui::test]

```
</events>
<input>
```crates/editor/src/inline_completion_tests.rs
<|editable_region_start|>
    // Cursor is 2+ lines below the proposed edit
    cx.set_state(indoc! {"
        line 0
        line
        line 2
        line 3
        line ˇ4
    "});

    propose_edits(
        &provider,
        vec![(Point::new(1, 3)..Point::new(1, 3), " 1")],
        &mut cx,
    );

    cx.update_editor(|editor, cx| editor.update_visible_inline_completion(cx));
    assert_editor_active_move_completion(&mut cx, |snapshot, move_target| {
        assert_eq!(move_target.to_point(&snapshot), Point::new(1, 3));
    });

    // When accepting, cursor is moved to the proposed location
    accept_completion(&mut cx);
    cx.assert_editor_state(indoc! {"
        line 0
        linˇe
        line 2
        line 3
        line 4
    "});
}

#[gpui::test]
async fn test_inden<|user_cursor_is_here|>(cx: &mut gpui::TestAppContext) {
}

#[gpui::test]
async fn test_inline_completion_invalidation_range(cx: &mut gpui::TestAppContext) {
    init_test(cx, |_| {});

    let mut cx = EditorTestContext::new(cx).await;
    let provider = cx.new_model(|_| FakeInlineCompletionProvider::default());
    assign_editor_completion_provider(provider.clone(), &mut cx);

    // Cursor is 3+ lines above the proposed edit
    cx.set_state(indoc! {"
        line 0
        line ˇ1
        line 2
        line 3
        line 4
        line
    "});
    let edit_location = Point::new(5, 3);

    propose_edits(
        &provider,
        vec![(edit_location..edit_location, " 5")],
        &mut cx,
    );

    cx.update_editor(|editor, cx| editor.update_visible_inline_completion(cx));
    assert_editor_active_move_completion(&mut cx, |snapshot, move_target| {
        assert_eq!(move_target.to_point(&snapshot), edit_location);
    });

<|editable_region_end|>
    // If we move *towards* the completion, it stays active
```
</input>
<output>
```crates/editor/src/inline_completion_tests.rs
<|editable_region_start|>
    // Cursor is 2+ lines below the proposed edit
    cx.set_state(indoc! {"
        line 0
        line
        line 2
        line 3
        line ˇ4
    "});

    propose_edits(
        &provider,
        vec![(Point::new(1, 3)..Point::new(1, 3), " 1")],
        &mut cx,
    );

    cx.update_editor(|editor, cx| editor.update_visible_inline_completion(cx));
    assert_editor_active_move_completion(&mut cx, |snapshot, move_target| {
        assert_eq!(move_target.to_point(&snapshot), Point::new(1, 3));
    });

    // When accepting, cursor is moved to the proposed location
    accept_completion(&mut cx);
    cx.assert_editor_state(indoc! {"
        line 0
        linˇe
        line 2
        line 3
        line 4
    "});
}

#[gpui::test]
async fn test_indentation(cx: &mut gpui::TestAppContext) {
    init_test(cx, |_| {});
    
    let mut cx = EditorTestContext::new(cx).await;
    let provider = cx.new_model(|_| FakeInlineCompletionProvider::default());
    assign_editor_completion_provider(provider.clone(), &mut cx);
}

#[gpui::test]
async fn test_inline_completion_invalidation_range(cx: &mut gpui::TestAppContext) {
    init_test(cx, |_| {});

    let mut cx = EditorTestContext::new(cx).await;
    let provider = cx.new_model(|_| FakeInlineCompletionProvider::default());
    assign_editor_completion_provider(provider.clone(), &mut cx);

    // Cursor is 3+ lines above the proposed edit
    cx.set_state(indoc! {"
        line 0
        line ˇ1
        line 2
        line 3
        line 4
        line
    "});
    let edit_location = Point::new(5, 3);

    propose_edits(
        &provider,
        vec![(edit_location..edit_location, " 5")],
        &mut cx,
    );

    cx.update_editor(|editor, cx| editor.update_visible_inline_completion(cx));
    assert_editor_active_move_completion(&mut cx, |snapshot, move_target| {
        assert_eq!(move_target.to_point(&snapshot), edit_location);
    });

<|editable_region_end|>
    // If we move *towards* the completion, it stays active
```
</output>
<outline>
```crates/editor/src/inline_completion_tests.rs
async fn test_inline_completion_insert
async fn test_inline_completion_modification
async fn test_inline_completion_jump_button
async fn test_inden
async fn test_inline_completion_invalidation_range
fn assert_editor_active_edit_completion
fn assert_editor_active_move_completion
fn accept_completion
fn propose_edits
fn assign_editor_completion_provider
struct FakeInlineCompletionProvider
 completion
impl FakeInlineCompletionProvider
 pub fn set_inline_completion
impl InlineCompletionProvider for FakeInlineCompletionProvider
 fn name
 fn display_name
 fn show_completions_in_menu
 fn show_completions_in_normal_mode
 fn is_enabled
 fn refresh
 fn cycle
 fn accept
 fn discard
 fn suggest
```

</outline>

<assertions>
Ensure there's a test function called exactly `test_inline_completion_invalidation_range`.
Ensure there is a test function called `test_indentation` or similar.
Optionally, the `test_indentation` function has a body with test setup.
</assertions>

<labels>
local-edit,complete-implementation
</labels>

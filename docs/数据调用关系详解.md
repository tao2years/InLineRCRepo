# InLineRCRepo æ•°æ®è°ƒç”¨å…³ç³»è¯¦è§£

## ğŸ“‹ ç›®å½•
1. [æ ¸å¿ƒæ•°æ®ç»“æ„](#æ ¸å¿ƒæ•°æ®ç»“æ„)
2. [æ¨¡å—é—´è°ƒç”¨å…³ç³»](#æ¨¡å—é—´è°ƒç”¨å…³ç³»)
3. [æ•°æ®è½¬æ¢æµç¨‹](#æ•°æ®è½¬æ¢æµç¨‹)
4. [å…³é”®å‡½æ•°è°ƒç”¨é“¾](#å…³é”®å‡½æ•°è°ƒç”¨é“¾)
5. [æ•°æ®æµå‘è¿½è¸ª](#æ•°æ®æµå‘è¿½è¸ª)

---

## 1. æ ¸å¿ƒæ•°æ®ç»“æ„

### 1.1 GitDiffRecord (Zetaæ•°æ®æ ¼å¼)

**å®šä¹‰ä½ç½®**: `zeta_full/data_processor.py`

```python
@dataclass
class GitDiffRecord:
    """åŸå§‹Git Diffæ•°æ®ç»“æ„"""
    mrcr_url: str              # MR/CRé“¾æ¥
    file_path: str             # æ–‡ä»¶è·¯å¾„
    code_type: str             # ç¼–ç¨‹è¯­è¨€ (java/python/js)
    old_file: str              # ä¿®æ”¹å‰å®Œæ•´æ–‡ä»¶å†…å®¹
    new_file: str              # ä¿®æ”¹åå®Œæ•´æ–‡ä»¶å†…å®¹
    old_hunk: str              # ä¿®æ”¹å‰ä»£ç å—
    new_hunk: str              # ä¿®æ”¹åä»£ç å—
    old_commit_id: str         # æ—§commit SHA
    new_commit_id: str         # æ–°commit SHA
    review_line: int           # Reviewæ‰€åœ¨è¡Œå·
    review_message: str        # Reviewè¯„è®ºå†…å®¹
    severity: str              # ä¸¥é‡ç¨‹åº¦
    category: str              # åˆ†ç±»
    author: str                # ä½œè€…
    start_line: int            # èµ·å§‹è¡Œå·
    end_line: int              # ç»“æŸè¡Œå·
    code_with_line: str        # å¸¦è¡Œå·çš„ä»£ç 
```

**ä½¿ç”¨åœºæ™¯**:
- Zetaæ•°æ®é›†è§£æ
- Gitå†å²åˆ†æ
- Code Reviewä¿¡æ¯æå–

---

### 1.2 BenchmarkEntry (Benchmarkæ•°æ®æ ¼å¼)

**å®šä¹‰ä½ç½®**: éšå¼å®šä¹‰ï¼Œé€šè¿‡JSON Schemaä½“ç°

```python
{
    "prompt": str,              # å®Œæ•´çš„promptæ–‡æœ¬
    "domain": str,              # é¢†åŸŸæ ‡è¯† (nl2code_java)
    "id": str,                  # å”¯ä¸€æ ‡è¯†ç¬¦
    "good_example_response": str,  # æœŸæœ›çš„ä»£ç å“åº”
    "reward_command": str,      # æµ‹è¯•å‘½ä»¤
    "extra_content": {          # é¢å¤–å…ƒæ•°æ®
        "query": str,           # åŠŸèƒ½æŸ¥è¯¢æè¿°
        "diff_path": str,       # diffæ–‡ä»¶è·¯å¾„
        "test_result": str,     # æµ‹è¯•ç»“æœ (pass/fail)
        "file_path": str,       # æºæ–‡ä»¶è·¯å¾„
        "start_line": int,      # èµ·å§‹è¡Œå·
        "end_line": int,        # ç»“æŸè¡Œå·
        "work_dir": str         # å·¥ä½œç›®å½•
    }
}
```

**ä½¿ç”¨åœºæ™¯**:
- Benchmarkæ•°æ®å­˜å‚¨
- æ¨¡å‹è®­ç»ƒè¾“å…¥
- è¯„æµ‹æ•°æ®åŠ è½½

---

### 1.3 CodeContext (ä»£ç ä¸Šä¸‹æ–‡)

**å®šä¹‰ä½ç½®**: `scripts/end_to_end_processor.py`

```python
{
    'context_above': str,       # ä¸Šæ–‡ä»£ç  (å¸¦è¡Œå·)
    'context_below': str,       # ä¸‹æ–‡ä»£ç  (å¸¦è¡Œå·)
    'selected_region': str,     # é€‰ä¸­çš„ä»£ç åŒºåŸŸ
    'target_implementation': str,  # ç›®æ ‡å®ç°ä»£ç 
    'final_code_with_annotations': str  # å®Œæ•´ä»£ç (å¸¦æ ‡æ³¨)
}
```

**ä½¿ç”¨åœºæ™¯**:
- ä»£ç ä¸Šä¸‹æ–‡æå–
- Promptæ„å»º
- RCç”Ÿæˆè¾“å…¥

---

### 1.4 RecentChange (Recent Changes)

**å®šä¹‰ä½ç½®**: `create_multi_rc_benchmarks.py`

```python
{
    'number': int,              # RCç¼–å· (1/2/3)
    'content': str,             # RCå®Œæ•´å†…å®¹
    'description': str,         # æè¿° (Latest/Intermediate/Earliest)
    'diff_content': str         # Diffå†…å®¹
}
```

**ä½¿ç”¨åœºæ™¯**:
- RCä¿¡æ¯å­˜å‚¨
- å¤šç‰ˆæœ¬ç”Ÿæˆ
- Promptç»„è£…

---

## 2. æ¨¡å—é—´è°ƒç”¨å…³ç³»

### 2.1 æ•°æ®ä¸‹è½½æ¨¡å—

```
download_zeta_dataset.py
    â”œâ”€â”€ huggingface_hub.snapshot_download()
    â”‚   â””â”€â”€ ä¸‹è½½å®Œæ•´æ•°æ®é›†åˆ° zeta_full/
    â”‚
    â””â”€â”€ datasets.load_dataset()
        â””â”€â”€ åŠ è½½å¹¶å¯¼å‡ºä¸ºJSONL/Parquet
            â”œâ”€â”€ train.jsonl
            â”œâ”€â”€ eval.jsonl
            â””â”€â”€ dpo.jsonl
```

**è°ƒç”¨ç¤ºä¾‹**:
```python
# 1. å¿«ç…§ä¸‹è½½
local_path = snapshot_download(
    repo_id="zed-industries/zeta",
    repo_type="dataset",
    local_dir="zeta_full"
)

# 2. ç»“æ„åŒ–å¯¼å‡º
ds = load_dataset("zed-industries/zeta")
ds['train'].to_json("zeta_exports/train.jsonl")
```

---

### 2.2 æ•°æ®å¤„ç†æ¨¡å—

```
data_processor.py
    â”œâ”€â”€ CursorPositionInferrer
    â”‚   â”œâ”€â”€ infer_cursor_position(GitDiffRecord)
    â”‚   â”‚   â”œâ”€â”€ _parse_code_with_line()
    â”‚   â”‚   â”œâ”€â”€ _analyze_diff_type()
    â”‚   â”‚   â””â”€â”€ _find_modification_point()
    â”‚   â””â”€â”€ è¿”å›: (line_num, col_pos)
    â”‚
    â”œâ”€â”€ ContextExtractor
    â”‚   â”œâ”€â”€ extract_context(GitDiffRecord, cursor_pos)
    â”‚   â”‚   â”œâ”€â”€ _split_code_by_cursor()
    â”‚   â”‚   â”œâ”€â”€ _get_context_window()
    â”‚   â”‚   â””â”€â”€ _format_with_line_numbers()
    â”‚   â””â”€â”€ è¿”å›: CodeContext
    â”‚
    â””â”€â”€ RecentChangesBuilder
        â”œâ”€â”€ build_recent_changes(GitDiffRecord)
        â”‚   â”œâ”€â”€ _extract_diff_hunks()
        â”‚   â”œâ”€â”€ _format_as_unified_diff()
        â”‚   â””â”€â”€ _add_line_annotations()
        â””â”€â”€ è¿”å›: List[RecentChange]
```

**è°ƒç”¨é“¾ç¤ºä¾‹**:
```python
# å®Œæ•´å¤„ç†æµç¨‹
git_record = parse_git_diff(raw_data)
    â†“
cursor_pos = CursorPositionInferrer().infer_cursor_position(git_record)
    â†“
context = ContextExtractor().extract_context(git_record, cursor_pos)
    â†“
recent_changes = RecentChangesBuilder().build_recent_changes(git_record)
    â†“
prompt = build_prompt(context, recent_changes)
```

---

### 2.3 ç«¯åˆ°ç«¯å¤„ç†æ¨¡å—

```
end_to_end_processor.py
    â”œâ”€â”€ EndToEndProcessor
    â”‚   â”œâ”€â”€ load_benchmark_data()
    â”‚   â”‚   â””â”€â”€ è¯»å–JSONL â†’ List[BenchmarkEntry]
    â”‚   â”‚
    â”‚   â”œâ”€â”€ extract_code_info(BenchmarkEntry)
    â”‚   â”‚   â”œâ”€â”€ æå–selected_region
    â”‚   â”‚   â”œâ”€â”€ æå–target_implementation
    â”‚   â”‚   â””â”€â”€ reconstruct_full_code()
    â”‚   â”‚       â””â”€â”€ è¿”å›: CodeContext
    â”‚   â”‚
    â”‚   â”œâ”€â”€ build_rc_prompt(CodeContext)
    â”‚   â”‚   â”œâ”€â”€ load_rc_prompt_template()
    â”‚   â”‚   â”œâ”€â”€ å¡«å……ä»£ç ä¿¡æ¯
    â”‚   â”‚   â””â”€â”€ è¿”å›: RCç”Ÿæˆprompt
    â”‚   â”‚
    â”‚   â”œâ”€â”€ call_llm_api(prompt)
    â”‚   â”‚   â””â”€â”€ GPT-4o/GPT-5 â†’ RCå“åº”
    â”‚   â”‚
    â”‚   â”œâ”€â”€ parse_rc_response(response)
    â”‚   â”‚   â”œâ”€â”€ æå–diffå—
    â”‚   â”‚   â”œâ”€â”€ è§£æè¡Œå·
    â”‚   â”‚   â””â”€â”€ è¿”å›: List[RecentChange]
    â”‚   â”‚
    â”‚   â””â”€â”€ build_final_prompt(context, recent_changes)
    â”‚       â””â”€â”€ è¿”å›: å®Œæ•´Benchmark prompt
```

**è°ƒç”¨ç¤ºä¾‹**:
```python
processor = EndToEndProcessor()

# 1. åŠ è½½æ•°æ®
data = processor.load_benchmark_data()

# 2. å¤„ç†æ¯æ¡æ•°æ®
for entry in data:
    # æå–ä»£ç ä¿¡æ¯
    code_info = processor.extract_code_info(entry)
    
    # ç”ŸæˆRC
    rc_prompt = processor.build_rc_prompt(code_info)
    rc_response = processor.call_llm_api(rc_prompt)
    recent_changes = processor.parse_rc_response(rc_response)
    
    # æ„å»ºæœ€ç»ˆprompt
    final_prompt = processor.build_final_prompt(
        code_info, recent_changes
    )
    
    # ä¿å­˜ç»“æœ
    processor.save_to_jsonl(final_prompt)
```

---

### 2.4 æ ¼å¼æ ‡å‡†åŒ–æ¨¡å—

```
generate_separated_benchmark.py
    â”œâ”€â”€ split_context(prompt)
    â”‚   â”œâ”€â”€ æŸ¥æ‰¾"context above"æ ‡è®°
    â”‚   â”œâ”€â”€ æŸ¥æ‰¾"context below"æ ‡è®°
    â”‚   â””â”€â”€ è¿”å›: (context_above, context_below)
    â”‚
    â”œâ”€â”€ add_line_numbers(code_lines, start_line)
    â”‚   â”œâ”€â”€ éå†æ¯è¡Œä»£ç 
    â”‚   â”œâ”€â”€ æ ¼å¼åŒ–ä¸º "è¡Œå·: ä»£ç "
    â”‚   â””â”€â”€ è¿”å›: List[numbered_line]
    â”‚
    â””â”€â”€ format_separated_benchmark(entry)
        â”œâ”€â”€ split_context()
        â”œâ”€â”€ add_line_numbers()
        â”œâ”€â”€ extract_recent_changes()
        â””â”€â”€ è¿”å›: Separatedæ ¼å¼entry
```

---

### 2.5 RCä¿®å¤æ¨¡å—

```
fix_rc_strict.py
    â”œâ”€â”€ RCFixer
    â”‚   â”œâ”€â”€ extract_rc_blocks(prompt)
    â”‚   â”‚   â”œâ”€â”€ æ­£åˆ™åŒ¹é…RCå—
    â”‚   â”‚   â””â”€â”€ è¿”å›: List[RCå—]
    â”‚   â”‚
    â”‚   â”œâ”€â”€ parse_diff_lines(rc_content)
    â”‚   â”‚   â”œâ”€â”€ è§£æ@@å¤´ä¿¡æ¯
    â”‚   â”‚   â”œâ”€â”€ åˆ†ç±»diffè¡Œ (+/-/ç©ºæ ¼)
    â”‚   â”‚   â””â”€â”€ è¿”å›: List[DiffLine]
    â”‚   â”‚
    â”‚   â”œâ”€â”€ match_in_context(diff_line, context)
    â”‚   â”‚   â”œâ”€â”€ æ ‡å‡†åŒ–ä»£ç 
    â”‚   â”‚   â”œâ”€â”€ ç²¾ç¡®åŒ¹é…
    â”‚   â”‚   â”œâ”€â”€ æ¨¡ç³ŠåŒ¹é… (ç›¸ä¼¼åº¦>40%)
    â”‚   â”‚   â””â”€â”€ è¿”å›: (line_num, original_content)
    â”‚   â”‚
    â”‚   â”œâ”€â”€ sort_diff_lines(diff_lines)
    â”‚   â”‚   â”œâ”€â”€ åˆ é™¤è¡Œæ’åº
    â”‚   â”‚   â”œâ”€â”€ æ·»åŠ è¡Œæ’åº
    â”‚   â”‚   â”œâ”€â”€ ä¸Šä¸‹æ–‡è¡Œæ’åº
    â”‚   â”‚   â””â”€â”€ è¿”å›: æ’åºåçš„diff_lines
    â”‚   â”‚
    â”‚   â””â”€â”€ format_as_unified_diff(diff_lines)
    â”‚       â”œâ”€â”€ ç”Ÿæˆ@@å¤´
    â”‚       â”œâ”€â”€ æ ¼å¼åŒ–æ¯è¡Œ
    â”‚       â””â”€â”€ è¿”å›: æ ‡å‡†unified diff
```

**è°ƒç”¨ç¤ºä¾‹**:
```python
fixer = RCFixer()

# 1. æå–RCå—
rc_blocks = fixer.extract_rc_blocks(prompt)

# 2. å¤„ç†æ¯ä¸ªRCå—
for rc in rc_blocks:
    # è§£ædiffè¡Œ
    diff_lines = fixer.parse_diff_lines(rc['content'])
    
    # åŒ¹é…context
    for diff_line in diff_lines:
        line_num, content = fixer.match_in_context(
            diff_line, context
        )
        diff_line.line_num = line_num
        diff_line.content = content
    
    # æ’åºå’Œæ ¼å¼åŒ–
    sorted_lines = fixer.sort_diff_lines(diff_lines)
    formatted_diff = fixer.format_as_unified_diff(sorted_lines)
    
    # æ›´æ–°RCå—
    rc['content'] = formatted_diff
```

---

### 2.6 å¤šç‰ˆæœ¬ç”Ÿæˆæ¨¡å—

```
create_multi_rc_benchmarks.py
    â”œâ”€â”€ load_existing_data()
    â”‚   â”œâ”€â”€ è¯»å–3RCæºæ–‡ä»¶
    â”‚   â”œâ”€â”€ è¯»å–2RCæºæ–‡ä»¶
    â”‚   â””â”€â”€ è¿”å›: List[BenchmarkEntry]
    â”‚
    â”œâ”€â”€ extract_recent_changes(prompt)
    â”‚   â”œâ”€â”€ æŸ¥æ‰¾RC section
    â”‚   â”œâ”€â”€ æ­£åˆ™æå–æ¯ä¸ªRC
    â”‚   â”œâ”€â”€ æŒ‰ç¼–å·æ’åº
    â”‚   â””â”€â”€ è¿”å›: List[RecentChange]
    â”‚
    â”œâ”€â”€ create_rc_version(entry, num_changes)
    â”‚   â”œâ”€â”€ extract_recent_changes()
    â”‚   â”œâ”€â”€ é€‰æ‹©å‰num_changesä¸ªRC
    â”‚   â”œâ”€â”€ é‡å»ºRC section
    â”‚   â”œâ”€â”€ æ›¿æ¢åŸpromptä¸­çš„RC
    â”‚   â””â”€â”€ è¿”å›: æ–°çš„BenchmarkEntry
    â”‚
    â””â”€â”€ main()
        â”œâ”€â”€ load_existing_data()
        â”œâ”€â”€ å¯¹æ¯æ¡æ•°æ®:
        â”‚   â”œâ”€â”€ create_rc_version(entry, 3)
        â”‚   â”œâ”€â”€ create_rc_version(entry, 2)
        â”‚   â””â”€â”€ create_rc_version(entry, 1)
        â””â”€â”€ ä¿å­˜åˆ°3ä¸ªæ–‡ä»¶
```

**è°ƒç”¨ç¤ºä¾‹**:
```python
# 1. åŠ è½½æ•°æ®
all_data = load_existing_data()

# 2. ç”Ÿæˆå¤šç‰ˆæœ¬
for entry in all_data:
    # æå–RC
    changes = extract_recent_changes(entry['prompt'])
    
    # ç”Ÿæˆ3ä¸ªç‰ˆæœ¬
    entry_3rc = create_rc_version(entry, 3)  # RC1+RC2+RC3
    entry_2rc = create_rc_version(entry, 2)  # RC1+RC2
    entry_1rc = create_rc_version(entry, 1)  # RC1
    
    # ä¿å­˜
    save_to_file(entry_3rc, '3RC.jsonl')
    save_to_file(entry_2rc, '2RC.jsonl')
    save_to_file(entry_1rc, '1RC.jsonl')
```

---

## 3. æ•°æ®è½¬æ¢æµç¨‹

### 3.1 Zeta â†’ Benchmarkè½¬æ¢

```
ZetaåŸå§‹æ•°æ®
    â†“ parse_git_diff()
GitDiffRecord {
    old_file, new_file,
    old_hunk, new_hunk,
    review_line, ...
}
    â†“ infer_cursor_position()
(line_num, col_pos)
    â†“ extract_context()
CodeContext {
    context_above,
    context_below,
    selected_region
}
    â†“ build_recent_changes()
List[RecentChange]
    â†“ build_prompt()
BenchmarkEntry {
    prompt: "...",
    domain: "nl2code_java",
    id: "...",
    ...
}
```

---

### 3.2 åŸå§‹æ ¼å¼ â†’ Separatedæ ¼å¼è½¬æ¢

```
åŸå§‹Benchmark (æ··åˆcontext)
{
    prompt: "...context above and below mixed..."
}
    â†“ split_context()
{
    context_above: "...",
    context_below: "..."
}
    â†“ add_line_numbers()
{
    context_above: "  1: ...\n  2: ...",
    context_below: "101: ...\n102: ..."
}
    â†“ extract_recent_changes()
{
    recent_changes: [RC1, RC2, RC3]
}
    â†“ format_separated_benchmark()
Separated Benchmark
{
    prompt: "...properly formatted with line numbers..."
}
```

---

### 3.3 å®Œæ•´æ•°æ® â†’ å¤šç‰ˆæœ¬è½¬æ¢

```
å®Œæ•´Benchmark (3RC)
{
    prompt: "...RC1, RC2, RC3..."
}
    â†“ extract_recent_changes()
[
    {number: 1, content: "..."},
    {number: 2, content: "..."},
    {number: 3, content: "..."}
]
    â†“ create_rc_version(entry, 2)
2RC Benchmark
{
    prompt: "...RC1, RC2..."
}
    â†“ create_rc_version(entry, 1)
1RC Benchmark
{
    prompt: "...RC1..."
}
```

---

## 4. å…³é”®å‡½æ•°è°ƒç”¨é“¾

### 4.1 å®Œæ•´å¤„ç†é“¾ (ç«¯åˆ°ç«¯)

```python
# å…¥å£
run_end_to_end.py
    â†“
EndToEndProcessor.process()
    â†“
â”œâ”€ load_benchmark_data()
â”‚   â””â”€ json.loads() Ã— Næ¡
â”‚
â”œâ”€ extract_code_info(entry)
â”‚   â”œâ”€ re.search() æå–ä»£ç å—
â”‚   â””â”€ reconstruct_full_code()
â”‚
â”œâ”€ build_rc_prompt(code_info)
â”‚   â”œâ”€ load_rc_prompt_template()
â”‚   â””â”€ template.format(**code_info)
â”‚
â”œâ”€ call_llm_api(prompt)
â”‚   â””â”€ requests.post(GPT_API)
â”‚
â”œâ”€ parse_rc_response(response)
â”‚   â”œâ”€ re.findall() æå–RCå—
â”‚   â””â”€ parse_diff_content()
â”‚
â””â”€ save_to_jsonl(result)
    â””â”€ json.dump()
```

---

### 4.2 RCä¿®å¤é“¾

```python
# å…¥å£
fix_rc_strict.py
    â†“
RCFixer.fix_all_entries()
    â†“
â”œâ”€ extract_rc_blocks(prompt)
â”‚   â””â”€ re.findall(r'### Recent Change \d+.*?```diff.*?```')
â”‚
â”œâ”€ parse_diff_lines(rc_content)
â”‚   â”œâ”€ re.search(r'@@ -(\d+),(\d+) \+(\d+),(\d+) @@')
â”‚   â””â”€ classify_diff_lines()
â”‚
â”œâ”€ match_in_context(diff_line, context)
â”‚   â”œâ”€ normalize_code()
â”‚   â”œâ”€ exact_match()
â”‚   â””â”€ fuzzy_match() if needed
â”‚
â”œâ”€ sort_diff_lines(diff_lines)
â”‚   â”œâ”€ sort(deletion_lines)
â”‚   â”œâ”€ sort(addition_lines)
â”‚   â””â”€ sort(context_lines)
â”‚
â””â”€ format_as_unified_diff(sorted_lines)
    â”œâ”€ generate_header()
    â””â”€ format_each_line()
```

---

### 4.3 å¤šç‰ˆæœ¬ç”Ÿæˆé“¾

```python
# å…¥å£
create_multi_rc_benchmarks.py
    â†“
main()
    â†“
â”œâ”€ load_existing_data()
â”‚   â”œâ”€ open('3RC.jsonl')
â”‚   â””â”€ json.loads() Ã— 40æ¡
â”‚
â”œâ”€ extract_recent_changes(prompt)
â”‚   â”œâ”€ prompt.find('## Recent Changes Context')
â”‚   â”œâ”€ re.findall(r'### Recent Change (\d+)(.*?)')
â”‚   â””â”€ sort(key=lambda x: x['number'])
â”‚
â”œâ”€ create_rc_version(entry, num_changes)
â”‚   â”œâ”€ extract_recent_changes()
â”‚   â”œâ”€ selected = changes[:num_changes]
â”‚   â”œâ”€ rebuild_rc_section(selected)
â”‚   â””â”€ replace_in_prompt()
â”‚
â””â”€ save_to_file()
    â”œâ”€ open('1RC.jsonl', 'w')
    â”œâ”€ open('2RC.jsonl', 'w')
    â””â”€ open('3RC.jsonl', 'w')
```

---

## 5. æ•°æ®æµå‘è¿½è¸ª

### 5.1 ä»Zetaåˆ°Benchmark

```
HuggingFace: zed-industries/zeta
    â†“ download
zeta_full/*.md (åŸå§‹Markdownæ–‡ä»¶)
    â†“ parse
zeta_exports/train.jsonl (ç»“æ„åŒ–æ•°æ®)
    â†“ data_processor.py
GitDiffRecordå¯¹è±¡
    â†“ extract_context
CodeContextå¯¹è±¡
    â†“ build_prompt
Benchmark JSONL
```

### 5.2 ä»åŸå§‹åˆ°Separated

```
benchmark/nl2code_F*.jsonl (åŸå§‹)
    â†“ generate_separated_benchmark.py
ä¸´æ—¶å¤„ç†æ•°æ®
    â†“ improve_line_numbers.py
è¡Œå·å¯¹é½æ•°æ®
    â†“ fix_rc_strict.py
benchmark/*_separated_final_fixed.jsonl (æœ€ç»ˆ)
```

### 5.3 ä»å®Œæ•´åˆ°å¤šç‰ˆæœ¬

```
benchmark/nl2code_java_F20-40_with_rc_separated_final_fixed.jsonl (20æ¡)
benchmark/nl2code_java_all_20_with_rc_separated_final.jsonl (20æ¡)
    â†“ merge
40æ¡å®Œæ•´æ•°æ®
    â†“ create_multi_rc_benchmarks.py
benchmark/nl2code_java_complete_3RC.jsonl (40æ¡)
benchmark/nl2code_java_complete_2RC.jsonl (40æ¡)
benchmark/nl2code_java_complete_1RC.jsonl (40æ¡)
```

---

## 6. é…ç½®ä¸ä¾èµ–

### 6.1 é…ç½®æ–‡ä»¶

```python
# tools/config.py
INPUT_BENCHMARK_FILE = "benchmark/nl2code_F*.jsonl"
OUTPUT_DIR = "final_gpt4o_output_*/"
RC_PROMPT_TEMPLATE = "templates/RC_prompt_v9_improved.txt"
GPT_API_ENDPOINT = "..."
GPT_API_KEY = "..."
```

### 6.2 ä¾èµ–å…³ç³»

```
download_zeta_dataset.py
    â”œâ”€ huggingface_hub
    â””â”€ datasets

data_processor.py
    â”œâ”€ difflib
    â””â”€ ast

end_to_end_processor.py
    â”œâ”€ config.py
    â””â”€ json

fix_rc_strict.py
    â”œâ”€ re
    â””â”€ difflib

create_multi_rc_benchmarks.py
    â”œâ”€ json
    â””â”€ re
```

---

## 7. æ€»ç»“

### æ ¸å¿ƒæ•°æ®æµ

```
åŸå§‹æ•°æ®æº
    â†“ ä¸‹è½½/è§£æ
ç»“æ„åŒ–æ•°æ®
    â†“ ä¸Šä¸‹æ–‡æå–
ä»£ç ä¸Šä¸‹æ–‡
    â†“ RCç”Ÿæˆ
Recent Changes
    â†“ Promptæ„å»º
Benchmarkæ•°æ®
    â†“ æ ¼å¼æ ‡å‡†åŒ–
Separatedæ ¼å¼
    â†“ è´¨é‡ä¿®å¤
é«˜è´¨é‡Benchmark
    â†“ å¤šç‰ˆæœ¬ç”Ÿæˆ
1RC/2RC/3RCç‰ˆæœ¬
```

### å…³é”®è½¬æ¢ç‚¹

1. **Zeta â†’ GitDiffRecord**: åŸå§‹æ•°æ®è§£æ
2. **GitDiffRecord â†’ CodeContext**: ä¸Šä¸‹æ–‡æå–
3. **CodeContext â†’ RecentChanges**: RCç”Ÿæˆ
4. **RecentChanges â†’ Prompt**: Benchmarkæ„å»º
5. **Prompt â†’ Separated**: æ ¼å¼æ ‡å‡†åŒ–
6. **Separated â†’ Fixed**: è´¨é‡ä¿®å¤
7. **Fixed â†’ Multi-version**: å¤šç‰ˆæœ¬ç”Ÿæˆ

### æ•°æ®è´¨é‡ä¿è¯

- **æ¯ä¸ªè½¬æ¢ç‚¹éƒ½æœ‰éªŒè¯**
- **å…³é”®æ­¥éª¤æœ‰å¤‡ä»½**
- **å®Œæ•´çš„æ—¥å¿—è®°å½•**
- **å¯è¿½æº¯çš„å¤„ç†é“¾è·¯**

